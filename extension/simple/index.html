<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Viewpoint Subscription Plans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f5f5; color: #222; margin: 0; padding: 40px 20px;
    }
    h1 { text-align: center; font-weight: 600; color: #333; margin: 0 0 16px; }
    #zf-widget-root-id-basic {
      max-width: 800px; margin: 30px auto; background: #fff; border-radius: 12px;
      padding: 25px; box-shadow: 0 6px 25px rgba(0,0,0,0.08);
    }
    .note { max-width: 800px; margin: 0 auto; color:#555; }
  </style>
</head>
<body>

  <h1>Video Access Renewal 1.2</h1>

  <div id="zf-widget-root-id-basic"></div>
  <p class="note">Add <code>?email=you@domain.com</code> to the URL to prefill.</p>

  <script src="https://js.zohostatic.com/books/zfwidgets/assets/js/zf-widget.js"></script>
  <script>
    // read optional email param
    const qs = new URLSearchParams(location.search);
    const email = qs.get('email') || '';

    // this plan belongs to the GROWTH product, so use the GROWTH product_id
    const productIdGrowth = '2-097d3a0dc8e50807a3d6de534c7d7add992908e4b362f42a297f15e318f099729aede92cabe4edf858bcad6fd428a6fdf4bb5d54eab8dc85cdc51d8ddc5526b9';

    // base HPP for vid-ext-adv (Growth)
    const baseHpp = 'https://billing.zohosecure.com/subscribe/f4bb5d54eab8dc854cbe9f72ce93a778a5e12fff46ccfe5bad482bf477cf719e/vid-ext-adv';
    const hppUrl  = email ? `${baseHpp}?email=${encodeURIComponent(email)}` : baseHpp;

    const opts = {
      id: 'zf-widget-root-id-basic',
      product_id: productIdGrowth,           // ← this was wrong before
      template: 'elegant',
      pricebooks: [{
        pricebook_id: '2896001000000011001',
        currency_code: 'USD',
        currency_symbol: '$',
        plans: [{
          plan_code: 'vid-ext-adv',
          url: hppUrl,
          recurring_price: '65',
          recurring_price_formatted: '$65.00',
          hp_settings_id: '2896001000003247013'
        }]
      }],
      group_options: [],
      plans: [{ plan_code: 'vid-ext-adv', selectedAddons: [] }],
      theme: { color: '#7952b3', theme_color_light: '' },
      button_text: 'Subscribe',
      product_url: 'https://billing.zoho.com',
      price_caption: '',
      language_code: 'en',
      open_inSameTab: true
    };

    function init(attempt=0){
      if (window.ZFWidget && typeof ZFWidget.init === 'function') {
        ZFWidget.init('zf-pricing-table', opts);
        // quick sanity log: the rendered link should include ?email when provided
        setTimeout(() => {
          const a = document.querySelector('#zf-widget-root-id-basic a[href*="/subscribe/"]');
          console.log('Rendered HPP link:', a && a.href);
        }, 600);
      } else if (attempt < 15) {
        setTimeout(() => init(attempt+1), 150);
      } else {
        console.error('Zoho widget script not ready.');
      }
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', init)
      : init();
  </script>

</body>
</html>
