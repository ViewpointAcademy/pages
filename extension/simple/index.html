<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Viewpoint Subscription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font:16px/1.5 system-ui, Segoe UI, Roboto, Arial; background:#f7f7f9; margin:0; padding:32px; }
    .wrap { max-width: 900px; margin: 0 auto; background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08); padding:20px; }
    #digest { margin:16px 0; }
    .cta { display:inline-block; padding:10px 14px; border:0; border-radius:8px; background:#7952b3; color:#fff; cursor:pointer; font-weight:600; }
    #checkout { margin-top:16px; }
    .back { position:absolute; top:10px; left:10px; padding:8px 12px; border:0; border-radius:8px; background:#111; color:#fff; cursor:pointer; }
    .checkout { position:relative; border-radius:12px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.08); }
    .frame { width:100%; height:85vh; min-height:640px; border:0; }
    .tip { color:#555; font-size:14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Video Access Renewal 1.3</h1>
    <p class="tip">Email is optional. If provided via <code>?email=you@domain.com</code>, we’ll prefill it on checkout.</p>

    <!-- Pretty pricing (digest). We won't rely on its internal links. -->
    <div id="digest">
      <div id="zf-widget-root-id-247bfiiob"
           data-pricing-table="true"
           data-digest="2-097d3a0dc8e50807e6288c801c1d235ed70db5096352e669636a34db879d61f8ea3e88769d72c2a3b737c2b253195bdff4bb5d54eab8dc85cdc51d8ddc5526b9"
           data-product_url="https://billing.zoho.com"></div>
      <script src="https://js.zohostatic.com/books/zfwidgets/assets/js/zf-widget.js"></script>
    </div>

    <!-- Your own button that you 100% control -->
    <button class="cta" id="subscribeGrowth">Subscribe Growth</button>

    <div id="checkout"></div>
  </div>

  <script>
    const email = new URLSearchParams(location.search).get('email') || '';
    const planCode = 'vid-ext-adv'; // Growth plan
    const functionUrl = 'https://YOUR-ZOHO-FUNCTION-URL/create_hpp_url'; // replace

    async function createHostedPage(plan_code, email){
      const res = await fetch(functionUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ plan_code, email })
      }).then(r => r.json());

      const url = res?.hostedpage?.url;
      if (!url) throw new Error('No hostedpage.url in response');
      return url;
    }

    function openInline(url){
      const host = document.getElementById('checkout');
      host.innerHTML = `
        <div class="checkout">
          <button class="back" type="button">← Back to plans</button>
          <iframe class="frame" title="Checkout"
            sandbox="allow-forms allow-scripts allow-same-origin allow-popups"
            referrerpolicy="no-referrer"
            src="${url}"></iframe>
        </div>`;
      host.querySelector('.back').onclick = () => { host.innerHTML = ''; };
    }

    document.getElementById('subscribeGrowth').addEventListener('click', async () => {
      try {
        const url = await createHostedPage(planCode, email); // email optional
        openInline(url);
      } catch (e) {
        // worst case: navigate same tab
        console.error(e);
        // window.location.href = FALLBACK_URL;
      }
    });
  </script>
</body>
</html>
